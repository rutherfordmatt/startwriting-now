<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Writing Now - 3 minute journal</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C841TYRSY9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-C841TYRSY9');
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        // Streak tracking functions

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            position: relative;
            transition: all 0.3s ease;
        }

        .dark-mode .container {
            background: #2d3748;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .header {
            text-align: left;
            margin-bottom: 30px;
            position: relative;
        }

        .logo {
            font-size: 2.5em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            letter-spacing: -0.02em;
            transition: color 0.3s ease;
        }

        .streak-display {
            font-size: 1.1em;
            color: #667eea;
            font-weight: 500;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }

        .dark-mode .streak-display {
            color: #a0aec0;
        }

        .about-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9em;
            transition: color 0.3s ease;
            margin-top: 5px;
            display: inline-block;
        }

        .about-link:hover {
            color: #5a6fd8;
        }

        .dark-mode .about-link {
            color: #a0aec0;
        }

        .dark-mode .about-link:hover {
            color: #e2e8f0;
        }

        .dark-mode .logo {
            color: #e2e8f0;
        }

        .tagline {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .prompt-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            transition: background 0.3s ease;
        }

        .dark-mode .prompt-section {
            background: #4a5568;
        }

        .prompt-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-btn, .swap-btn {
            padding: 6px 20px;
            border: 2px solid #667eea;
            border-radius: 20px;
            background: transparent;
            color: #667eea;
            font-size: 0.85em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            min-width: 70px;
            text-align: center;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .filter-btn:hover, .swap-btn:hover {
            background: #667eea;
            color: white;
        }

        .dark-mode .filter-btn, .dark-mode .swap-btn {
            border-color: #a0aec0;
            color: #a0aec0;
        }

        .dark-mode .filter-btn.active {
            background: #a0aec0;
            color: #2d3748;
        }

        .dark-mode .filter-btn:hover, .dark-mode .swap-btn:hover {
            background: #a0aec0;
            color: #2d3748;
        }

        .prompt-label {
            font-weight: 500;
            color: #555;
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s ease;
        }

        .dark-mode .prompt-label {
            color: #a0aec0;
        }

        .prompt-text {
            font-size: 1.5em;
            color: #333;
            line-height: 1.4;
            font-style: italic;
            font-weight: 600;
            padding-right: 60px;
            transition: color 0.3s ease;
        }

        .dark-mode .prompt-text {
            color: #e2e8f0;
        }

        .swap-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            transition: all 0.3s ease;
        }

        .swap-icon:hover {
            background: #5a6fd8;
            transform: rotate(180deg);
        }

        .timer-section {
            text-align: center;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .timer-display {
            font-size: 3em;
            font-weight: 700;
            color: #667eea;
            font-family: 'Inter', sans-serif;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            font-family: 'Inter', sans-serif;
            flex: 1;
            max-width: 200px;
            min-width: 160px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .writing-area {
            margin-bottom: 25px;
        }

        .writing-textarea {
            width: 100%;
            min-height: 300px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            font-size: 1.1em;
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
            background: white;
            color: #333;
        }

        .dark-mode .writing-textarea {
            background: #4a5568;
            border-color: #718096;
            color: #e2e8f0;
        }

        .writing-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .writing-textarea::placeholder {
            color: #adb5bd;
            font-style: normal;
        }

        .dark-mode .writing-textarea::placeholder {
            color: #a0aec0;
        }

        .word-count {
            text-align: right;
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 10px;
            transition: color 0.3s ease;
        }

        .dark-mode .word-count {
            color: #a0aec0;
        }

        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: 2px solid #667eea;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode-toggle:hover {
            background: #667eea;
        }

        .dark-mode .dark-mode-toggle {
            border-color: #a0aec0;
            color: #a0aec0;
        }

        .dark-mode .dark-mode-toggle:hover {
            background: #a0aec0;
            color: #2d3748;
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .btn-copy {
            background: #17a2b8;
            color: white;
            padding: 15px 30px;
            font-size: 1.1em;
        }

        .btn-copy:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .footer {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            margin-top: 20px;
        }

        .dark-mode .footer {
            border-top-color: #4a5568;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .footer-link {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9em;
            transition: color 0.3s ease;
        }

        .footer-link:hover {
            color: #667eea;
        }

        .dark-mode .footer-link {
            color: #a0aec0;
        }

        .dark-mode .footer-link:hover {
            color: #e2e8f0;
        }

        .btn-save {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            font-size: 1.1em;
        }

        .btn-save:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-new:hover {
            background: #138496;
        }

        .timer-finished {
            color: #28a745 !important;
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 10px;
            }
            
            .logo {
                font-size: 2.2em;
            }
            
            .timer-display {
                font-size: 2.5em;
            }
            
            .timer-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                max-width: none;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle light mode">☀️</button>
        
        <div class="header">
            <div class="logo">Start Writing...</div>
            <div class="streak-display" id="streakDisplay">Start your writing streak!</div>
        </div>

        <div class="prompt-section">
            <div class="prompt-label">Random Prompt</div>
            <div class="prompt-text" id="currentPrompt">Loading your writing prompt...</div>
            <div class="prompt-controls">
                <button class="filter-btn active" onclick="setPromptFilter('all')">All</button>
                <button class="filter-btn" onclick="setPromptFilter('life')">Life</button>
                <button class="filter-btn" onclick="setPromptFilter('career')">Career</button>
                <button class="swap-btn" onclick="newPrompt()" title="Get new prompt">New</button>
            </div>
        </div>

        <div class="timer-section">
            <div class="timer-display" id="timerDisplay">3:00</div>
            <div class="timer-controls">
                <button class="btn btn-secondary" id="pauseBtn" onclick="pauseTimer()" style="visibility: hidden;">Pause</button>
            </div>
        </div>

        <div class="writing-area">
            <textarea 
                class="writing-textarea" 
                id="writingArea" 
                placeholder="Start writing..."
            ></textarea>
            <div class="word-count" id="wordCount">0 words</div>
        </div>

        <div class="actions">
            <button class="btn btn-copy" id="copyBtn" onclick="copyToClipboard()">Copy to Clipboard</button>
            <button class="btn btn-save" id="saveBtn" onclick="saveEntry()">Download Entry</button>
        </div>

        <!-- Hidden Netlify form for email collection -->
        <form name="newsletter-signup" method="POST" data-netlify="true" style="display:none;">
            <input type="email" name="email">
            <input type="text" name="source">
            <input type="text" name="entry_preview">
        </form>

        <div class="footer">
            <div class="footer-content">
                <div style="font-style: italic; color: #8b949e; font-size: 0.85em;">Built with curiosity and launched with hope by <a href="https://mattrutherford.co.uk" target="_blank" class="footer-link">Matt Rutherford</a></div>
                <div style="display: flex; gap: 16px; align-items: center;">
                    <a href="#about" class="footer-link" onclick="showAbout()">About</a>
                    <a href="mailto:feedback@mattrutherford.co.uk?subject=Start Writing Now - Feedback&body=Hi Matt,%0D%0A%0D%0AI tried your micro-journaling app and wanted to share some thoughts:%0D%0A%0D%0A" class="footer-link">Feedback</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Journaling prompts organized by category
        const prompts = {
            life: [
                "What's one thing that made you smile today?",
                "Describe a moment when you felt completely at peace.",
                "What's something you're grateful for right now?",
                "If you could tell your past self one thing, what would it be?",
                "What's a small win you had recently?",
                "Describe your ideal Sunday morning.",
                "What's something new you learned this week?",
                "How do you want to feel by the end of today?",
                "What's a challenge you're facing, and how might you approach it?",
                "Describe a person who has positively impacted your life.",
                "What's something you're looking forward to?",
                "How has your perspective on something changed recently?",
                "What would you do if you knew you couldn't fail?",
                "What's a habit you'd like to develop?",
                "How do you show kindness to yourself?",
                "What's something that always makes you laugh?",
                "Describe a place where you feel most like yourself.",
                "What's the best advice you've ever received?",
                "How do you like to celebrate small victories?",
                "What's something you're curious about right now?",
                "Describe a time when you felt proud of yourself.",
                "What does a meaningful day look like to you?",
                "How do you recharge when you're feeling drained?",
                "What's something you'd like to let go of?",
                "What skill would you love to master?",
                "Describe a conversation that changed your thinking.",
                "What brings you the most energy?",
                "What's a risk you're glad you took?",
                "Describe your relationship with technology.",
                "What's something you've always wanted to try?",
                "How do you handle uncertainty?",
                "What's your favorite way to be creative?",
                "Describe a tradition that's meaningful to you.",
                "What would you tell someone having a difficult day?",
                "How has failure taught you something valuable?",
                "What's something you do that feels authentic to who you are?",
                "What's a belief you've outgrown?",
                "How do you practice gratitude?",
                "What's something you've learned from a difficult relationship?",
                "Describe a moment when you felt truly understood.",
                "What's your relationship with money and security?",
                "How do you want to be remembered?",
                "What's something you're learning to accept about yourself?",
                "Describe a time when you surprised yourself.",
                "What role does nature play in your life?",
                "How do you nurture your relationships?",
                "What's something you wish people understood about you?",
                "What does home mean to you?",
                "How do you define a life well-lived?",
                "What's a fear you've overcome or are working to overcome?"
            ],
            career: [
                "What's the most valuable skill you've developed this year?",
                "Describe a project you're proud of and why.",
                "What's a professional challenge you're currently navigating?",
                "How do you define success in your career?",
                "What's something you want to learn to advance professionally?",
                "Describe your ideal work environment.",
                "What's a piece of feedback that changed how you work?",
                "How do you maintain work-life balance?",
                "What's a professional relationship that has been meaningful to you?",
                "Describe a time when you had to step outside your comfort zone at work.",
                "What's your biggest professional accomplishment this month?",
                "How do you handle stress and pressure in your work?",
                "What's a mistake you made that taught you something important?",
                "Describe your ideal role five years from now.",
                "What's a skill you wish you had developed earlier in your career?",
                "How do you stay motivated when work feels challenging?",
                "What's the best career advice you've ever received?",
                "Describe a mentor or role model who has influenced your career.",
                "What's something you want to improve about your communication style?",
                "How do you approach networking and building professional relationships?",
                "What's a professional goal you're working toward?",
                "Describe a time when you had to advocate for yourself at work.",
                "What's your approach to continuous learning and development?",
                "How do you handle criticism or negative feedback?",
                "What's something you love about your current work?",
                "Describe a time when you had to lead or influence others.",
                "What's a professional weakness you're working to strengthen?",
                "How do you prioritize tasks when everything feels urgent?",
                "What's a career pivot or change you're considering?",
                "Describe your approach to collaboration and teamwork.",
                "What's something you want to be known for professionally?",
                "How do you measure your professional growth?",
                "What's a professional boundary you've learned to set?",
                "Describe a time when you had to make a difficult decision at work.",
                "What's your strategy for staying organized and productive?",
                "How do you approach giving feedback to colleagues?",
                "What's a professional opportunity you're excited about?",
                "Describe your ideal company culture.",
                "What's something you want to contribute to your industry?",
                "How do you handle imposter syndrome or self-doubt at work?",
                "What's a professional skill you're currently developing?",
                "Describe a time when you exceeded your own expectations.",
                "What's your approach to managing up and working with supervisors?",
                "How do you stay current with trends in your field?",
                "What's a professional achievement you haven't celebrated enough?",
                "Describe your ideal morning routine for a productive workday.",
                "What's something you want to stop doing that doesn't serve your career?",
                "How do you approach problem-solving in your work?",
                "What's a professional value that guides your decisions?",
                "Describe how you want to grow as a leader or team member."
            ]
        };

        // Current filter state
        let currentFilter = 'all';

        // Timer variables
        let timeLeft = 180; // 3 minutes in seconds
        let timerInterval = null;
        let isRunning = false;

        // Initialize the app
        function initApp() {
            displayRandomPrompt();
            updateWordCount();
            updateStreakDisplay();
            
            // Set dark mode as default, but respect user preference if they've toggled before
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === null) {
                // First visit - default to dark mode
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'true');
            } else if (savedDarkMode === 'true') {
                document.body.classList.add('dark-mode');
            }
            updateDarkModeIcon();
            
            // Add textarea event listener for word count and auto-start timer
            const textarea = document.getElementById('writingArea');
            textarea.addEventListener('input', function() {
                updateWordCount();
                // Auto-start timer when user starts typing
                if (!isRunning && textarea.value.trim().length > 0 && timeLeft === 180) {
                    startTimer();
                }
            });
        }

        function displayRandomPrompt() {
            let promptArray;
            
            if (currentFilter === 'all') {
                // Combine all prompts when 'all' is selected
                promptArray = [...prompts.life, ...prompts.career];
            } else {
                promptArray = prompts[currentFilter];
            }
            
            const randomIndex = Math.floor(Math.random() * promptArray.length);
            document.getElementById('currentPrompt').textContent = promptArray[randomIndex];
        }

        function setPromptFilter(filter) {
            currentFilter = filter;
            
            // Update button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Get new prompt from selected category
            displayRandomPrompt();
        }

        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                document.getElementById('pauseBtn').style.visibility = 'visible';
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        finishTimer();
                    }
                }, 1000);
            }
        }

        function pauseTimer() {
            if (isRunning) {
                isRunning = false;
                clearInterval(timerInterval);
                document.getElementById('pauseBtn').style.visibility = 'hidden';
            }
        }

        function resetTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            timeLeft = 120;
            updateTimerDisplay();
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('timerDisplay').classList.remove('timer-finished', 'pulse');
        }

        function finishTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            timeLeft = 0;
            updateTimerDisplay();
            document.getElementById('pauseBtn').style.visibility = 'hidden';
            document.getElementById('timerDisplay').classList.add('timer-finished', 'pulse');
            
            // Play chime sound
            playChime();
            
            // Celebration message
            setTimeout(() => {
                alert('Great job! You completed your 3-minute writing session. 🎉');
            }, 500);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        function updateWordCount() {
            const text = document.getElementById('writingArea').value;
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            document.getElementById('wordCount').textContent = `${words.length} words`;
        }

        function copyToClipboard() {
            const prompt = document.getElementById('currentPrompt').textContent;
            const entry = document.getElementById('writingArea').value;
            
            if (entry.trim().length === 0) {
                alert('Please write something before copying!');
                return;
            }

            // Check if entry is substantial enough for streak (minimum 25 words)
            const words = entry.trim().split(/\s+/).filter(word => word.length > 0);
            if (words.length >= 25) {
                updateStreak();
            }
            
            // Create formatted text for clipboard
            const timestamp = new Date().toLocaleString();
            const formattedEntry = `Start Writing Now - Journal Entry
Date: ${timestamp}
Prompt: ${prompt}

${entry}

---
startwriting.now`;
            
            // Copy to clipboard
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(formattedEntry).then(() => {
                    const message = words.length >= 25 ? 
                        'Entry copied to clipboard! 📋' : 
                        'Entry copied to clipboard! Write 25+ words next time to count toward your streak. 📋';
                    alert(message);
                    
                    // Offer email backup after successful copy
                    setTimeout(() => {
                        offerEmailBackup(formattedEntry);
                    }, 1500);
                }).catch(err => {
                    // Fallback for older browsers
                    fallbackCopyToClipboard(formattedEntry, words.length);
                });
            } else {
                // Fallback for older browsers or non-secure contexts
                fallbackCopyToClipboard(formattedEntry, words.length);
            }
        }

        function fallbackCopyToClipboard(text, wordCount) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                const message = wordCount >= 25 ? 
                    'Entry copied to clipboard! 📋' : 
                    'Entry copied to clipboard! Write 25+ words next time to count toward your streak. 📋';
                alert(message);
                
                // Offer email backup after successful copy
                setTimeout(() => {
                    offerEmailBackup(text);
                }, 1500);
            } catch (err) {
                alert('Unable to copy to clipboard. Please try the download option instead.');
            }
            
            document.body.removeChild(textArea);
        }

        function newPrompt() {
            displayRandomPrompt();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            updateDarkModeIcon();
        }

        function updateDarkModeIcon() {
            const button = document.querySelector('.dark-mode-toggle');
            const isDarkMode = document.body.classList.contains('dark-mode');
            button.textContent = isDarkMode ? '☀️' : '🌙';
        }

        function playChime() {
            // Create a simple chime sound using Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Create three notes for a pleasant chime
            const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
            
            frequencies.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                oscillator.type = 'sine';
                
                // Set volume envelope for a soft chime
                const startTime = audioContext.currentTime + index * 0.2;
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 1.5);
                
                oscillator.start(startTime);
                oscillator.stop(startTime + 1.5);
            });
        }

        function saveEntry() {
            const prompt = document.getElementById('currentPrompt').textContent;
            const entry = document.getElementById('writingArea').value;
            
            if (entry.trim().length === 0) {
                alert('Please write something before downloading!');
                return;
            }

            // Check if entry is substantial enough for streak (minimum 25 words)
            const words = entry.trim().split(/\s+/).filter(word => word.length > 0);
            if (words.length >= 25) {
                updateStreak();
            }
            
            // Create formatted text for download
            const timestamp = new Date().toLocaleString();
            const formattedEntry = `Start Writing Now - Journal Entry
Date: ${timestamp}
Prompt: ${prompt}

${entry}

---
startwriting.now
`;
            
            // Create and trigger download
            const blob = new Blob([formattedEntry], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `journal-entry-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            const message = words.length >= 25 ? 
                'Your journal entry has been downloaded! 📝' : 
                'Your journal entry has been downloaded! Write 25+ words next time to count toward your streak. 📝';
            alert(message);
            
            // Offer email backup after successful download
            setTimeout(() => {
                offerEmailBackup(formattedEntry);
            }, 1500);
        }

        function showAbout() {
            alert(`About Start Writing

This is a simple micro-journaling app designed to help you capture your thoughts quickly and easily.

How it works:
• Get a random writing prompt
• Start typing to begin the 3-minute timer
• Write freely without worrying about structure
• Copy or download your entry when done

The goal is to make writing a daily habit through short, focused sessions. No accounts needed - just write and save locally.

Perfect for daily reflection, gratitude practice, or creative expression.`);
        }
        function getStreakData() {
            const defaultData = {
                currentStreak: 0,
                longestStreak: 0,
                lastWriteDate: null,
                writingDays: []
            };
            
            const stored = localStorage.getItem('writingStreak');
            return stored ? JSON.parse(stored) : defaultData;
        }

        function saveStreakData(data) {
            localStorage.setItem('writingStreak', JSON.stringify(data));
        }

        function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            const streakData = getStreakData();
            
            // Don't count multiple entries on the same day
            if (streakData.writingDays.includes(today)) {
                return;
            }
            
            // Add today to writing days
            streakData.writingDays.push(today);
            streakData.lastWriteDate = today;
            
            // Calculate current streak
            const sortedDays = streakData.writingDays.sort();
            let currentStreak = 1;
            
            for (let i = sortedDays.length - 2; i >= 0; i--) {
                const currentDate = new Date(sortedDays[i + 1]);
                const previousDate = new Date(sortedDays[i]);
                const dayDiff = (currentDate - previousDate) / (1000 * 60 * 60 * 24);
                
                if (dayDiff === 1) {
                    currentStreak++;
                } else {
                    break;
                }
            }
            
            streakData.currentStreak = currentStreak;
            
            // Update longest streak
            if (currentStreak > streakData.longestStreak) {
                streakData.longestStreak = currentStreak;
            }
            
            saveStreakData(streakData);
            updateStreakDisplay();
            celebrateStreak(currentStreak);
        }

        function updateStreakDisplay() {
            const streakData = getStreakData();
            const display = document.getElementById('streakDisplay');
            
            if (streakData.currentStreak === 0) {
                display.textContent = 'Start your writing streak!';
            } else if (streakData.currentStreak === 1) {
                display.textContent = '🔥 Day 1 - Keep it going!';
            } else {
                display.textContent = `🔥 ${streakData.currentStreak} day streak`;
                if (streakData.longestStreak > streakData.currentStreak) {
                    display.textContent += ` (Best: ${streakData.longestStreak})`;
                }
            }
        }

        function celebrateStreak(streak) {
            let message = '';
            
            if (streak === 1) {
                message = 'Great job starting your writing streak! 🎉';
            } else if (streak === 3) {
                message = 'Amazing! 3 days in a row! 🔥';
            } else if (streak === 7) {
                message = 'Incredible! You\'ve written for a whole week! 🌟';
                // Offer streak protection email after celebrating 7-day streak
                setTimeout(() => {
                    offerStreakProtection();
                }, 2000);
            } else if (streak === 14) {
                message = 'Two weeks of writing! You\'re building a real habit! 💪';
            } else if (streak === 30) {
                message = 'One month streak! You\'re a writing champion! 🏆';
            } else if (streak % 10 === 0 && streak > 30) {
                message = `${streak} days of writing! Absolutely incredible! 🎊`;
            }
            
            if (message) {
                setTimeout(() => alert(message), 1000);
            }
        }

        // Email collection functions
        function offerEmailBackup(entryText) {
            // Only offer if not previously declined
            if (localStorage.getItem('emailBackupDeclined') === 'true') {
                return;
            }
            
            // Don't offer too frequently
            const lastOffered = localStorage.getItem('lastEmailBackupOffer');
            const now = new Date().getTime();
            if (lastOffered && (now - parseInt(lastOffered)) < 7 * 24 * 60 * 60 * 1000) { // 7 days
                return;
            }
            
            if (confirm('💌 Want to email this entry to yourself?\n\n(You can also join my weekly newsletter for exclusive writing prompts)')) {
                // Open email client with entry
                const subject = 'My Writing Entry - ' + new Date().toDateString();
                const body = encodeURIComponent(entryText);
                window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
                
                // Ask for newsletter signup
                setTimeout(() => {
                    collectEmailForNewsletter('backup', entryText.substring(0, 100));
                }, 3000);
            } else {
                localStorage.setItem('emailBackupDeclined', 'true');
            }
            
            localStorage.setItem('lastEmailBackupOffer', now.toString());
        }

        function offerStreakProtection() {
            // Only offer once
            if (localStorage.getItem('streakEmailOffered') === 'true') {
                return;
            }
            
            if (confirm('🔥 7-day streak achieved! Want a gentle daily reminder to keep your streak alive?\n\n(I\'ll also send weekly writing prompts to help you grow)')) {
                collectEmailForNewsletter('streak', '7-day streak protection');
            }
            
            localStorage.setItem('streakEmailOffered', 'true');
        }

        function collectEmailForNewsletter(source, preview) {
            const email = prompt('Enter your email for ' + (source === 'backup' ? 'entry backup and ' : '') + 'weekly writing prompts:');
            
            if (email && email.includes('@')) {
                // Submit to Netlify form
                const formData = new FormData();
                formData.append('form-name', 'newsletter-signup');
                formData.append('email', email);
                formData.append('source', source);
                formData.append('entry_preview', preview);
                
                fetch('/', {
                    method: 'POST',
                    body: formData
                }).then(() => {
                    alert('✅ Thanks! You\'ll receive weekly writing prompts and updates.');
                }).catch(() => {
                    alert('Thanks! You\'ll receive weekly writing prompts and updates.');
                });
            }
        }

        // Initialize the app when page loads
        window.addEventListener('load', initApp);
    </script>
</body>
</html>